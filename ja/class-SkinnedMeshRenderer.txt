!スキンメッシュ レンダラ / Skinned Mesh Renderer

$$Skinned Mesh Renderer$$ (スキンメッシュ レンダラ)はメッシュがスキニングされている場合、インポート時に自動追加されます。

Attach:Inspector-SkinnedMeshRenderer.png\\
スキンメッシュ レンダラを用いてレンダリングされたアニメキャラクター


!! プロパティ

||PROPS
||``Cast Shadows`` (Unity Pro のみ) ||オンにした場合、メッシュは影を生成するライトが照らしてたときに影を生成します。||
||``Receive Shadows`` (Unity Pro のみ) ||オンにした場合、メッシュに対して投影された影を描画します。||
||``Materials`` ||モデルでレンダリングする $$Materials$$ の一覧。||
||``Quality`` ||すべての頂点に影響を与えるボーンの最大数。||
||``Update When Offscreen`` ||オンにした場合、メッシュは画面の外のとき更新される。オフにした場合、アニメーションの更新が無効になります。||
||``Bounds`` ||このBounds（境界）はスキンメッシュを画面外に出たかどうかを判断するために用います。境界線となる箱もシーンビューに表示されます。境界は、インポート時にモデルに含まれるメッシュとアニメーションに基づいて事前計算されます。||
||``Mesh`` ||レンダラによって使用されるメッシュ。||

!! 詳細

スキンメッシュは、キャラクターのレンダリングに使用されます。キャラクターはボーンを使用してアニメーション化しており、すべてのボーンは、メッシュの一部に影響を与えます。複数のボーンが同じひとつの頂点に影響を与えることができ、影響の大きさは重み付けされています。ボーンアニメーショはメッシュ形状を変形させる一般的なテクニックであり、手足を関節で曲げることが出来たり、似たようなエフェクトを実現できます。それに加えて、 Rigidbody および キャラクター ジョイント コンポーネントをボーンにアタッチすることで物理挙動の中でも現実的な動作を実現することができます。よく知られた "Ragdoll" エフェクトもこの方法で実装されています。

Attach:RagdollRobot.png\\
Ragdoll として有効化したスキンメッシュ

!!! 品質 / Quality

Unity によりすべての頂点を1、2、または 4 のいずれかの個数のボーンでスキニングするよう設定ができます。 4ボーンウェイトは外観も良い一方で、処理コストが高くなります。2ボーンウェイトは良い妥協点であり、一般的にゲームで使用することができます。

``Quality``が``Automatic``にセットされた場合 [[class-QualitySettings|Quality Settings]] の``Blend Weights`` が使用されます。これによりエンドユーザが最適なパフォーマンスの品質設定を選択することができます。


!!! 画面外の更新とBounds（境界）

デフォルトでは、表示されていないスキンメッシュは更新されません。メッシュが画面内に戻ってくるまでのスキニングは更新されません。これはパフォーマンスの最適化の観点で重要なポイントで、たくさんのキャラクターが走り回っても非表示のときは処理負荷を抑えることができます。

しかし、VisibilityはメッシュのBounds（境界）により決定され、インポート時に事前計算されます。Unityはすべてのアタッチされたアニメーションを境界の大きさ事前計算において考慮しますが、場合によってはUnityが強化をユーザのニーズに合うように計算できないことがあります。例えば：（いずれも問題となってくるのはボーンや頂点を事前計算された領域外に押し出されるときです。）
* ランタイム時にアニメーションを追加した場合
* Additive（追加）アニメーションを使用した場合
* ボーンの位置をプロシージャで影響を及ぼした場合
* 頂点シェーダを使用して、事前計算された境界の外に頂点を押し出した場合
* Ragdollを使用した場合。

これらの例では、2つの解決方法があります：
# Bounds（境界）を修正してメッシュの潜在的な境界の大きさにマッチできるように修正します。
# ``Update When Offscreen``をスキンおよびレンダリングされたスキンメッシュに対して常にオンにします。

ほとんｎどの場合、最初の方法がパフォーマンスに与える影響も少ないため、選択することになりますが、二つめの方法はパフォーマンスを重視する必要がなく、境界の大きさを予測することが難しい場合のみ使用して下さい。（例えば Ragdoll の場合）

スキンメッシュを Ragdoll で上手に機能させるために、Unity は、ルートボーンに対してスキンメッシュレンダラを再マッピングします。しかしUnityモデルファイルに対してひとつのみスキンメッシュレンダラがある場合にこれを行います。
したがってすべてのスキンメッシュレンダラをルートボーンや子オブジェクトにアタッチできない場合や Ragdoll を使用する場合、この最適化をオフにする必要があります。

!! ヒント

* スキンメッシュが現在インポートできるのは：
** Maya
** Cinema4D
** 3D Studio Max
** Blender
** Cheetah 3D
** XSI
** FBXフォーマットをサポートしている他のあらゆるツール

>>mobile<<
モバイルでは hand-codedされたNEON/VFP命令でCPUがスキニングをします。注意： 法線とタンジェントは規格化__されません__ので、自分で書いたシェーダーであれば、自分で規格化はしてください。もし、[[SL-SurfaceShaders | サーフェイス シェーダ]] をお使いであれば、規格化は自動的に生成されます。
